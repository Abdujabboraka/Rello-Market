{% extends "base.html" %}
{% load static %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}

<div class="container mt-4">
    <div class="row">

        <!-- Product Image -->
        <div class="col-md-6 mb-3">
            {% if product.image %}
                <img src="{{ product.image.url }}" class="img-fluid rounded shadow" alt="{{ product.name }}">
            {% else %}
                <img src="{% static 'no-image.png' %}" class="img-fluid rounded shadow" alt="No image">
            {% endif %}
        </div>

        <!-- Product Info -->
        <div class="col-md-6">
            <h3 class="fw-bold">{{ product.name }}</h3>

            {% if product.price %}
                <p class="price-tag fs-4 text-success">${{ product.price }}</p>
            {% endif %}

            <p class="mt-3">{{ product.description|linebreaks }}</p>

            <!-- Add to Cart -->
            <form action="{% url 'add_to_cart' product.link %}" method="POST" class="add-cart-form mt-3">
                {% csrf_token %}
                <button type="submit" class="btn btn-success btn-lg">
                    <i class="fa fa-cart-plus"></i> Add to Cart
                </button>
            </form>
        </div>

    </div>
</div>

<!-- CSS -->
<style>
.price-tag {
    font-weight: bold;
    color: #28a745;
}
.add-cart-form button {
    transition: 0.2s ease;
}
.add-cart-form button:hover {
    transform: scale(1.05);
}
</style>

<!-- AJAX Add to Cart -->
<script>
document.querySelectorAll('.add-cart-form').forEach(form => {
    form.addEventListener('submit', function(e){
        e.preventDefault();
        const url = form.action;
        const csrf = form.querySelector('[name=csrfmiddlewaretoken]').value;

        fetch(url, {
            method: 'POST',
            headers: {'X-CSRFToken': csrf},
        })
        .then(res => res.json())
        .then(data => {
            if(data.status === 'ok'){
                alert("✅ Added to cart!");
            } else {
                alert("❌ Error adding to cart");
            }
        })
        .catch(err => console.log(err));
    });
});
</script>

{% endblock %}
